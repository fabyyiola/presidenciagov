<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Tu Ciudad - Sabinas Hidalgo, Nuevo Le√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "municipal-blue": "#2563eb",
              "municipal-teal": "#14b8a6",
              "municipal-pink": "#f87171",
              "municipal-green": "#22c55e",
              "gov-blue": "#1e40af",
              "gov-green": "#059669",
              "gov-gray": "#6b7280",
              "gov-light": "#f8fafc",
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="font-sans bg-white">


    <!-- Hero -->
    <section class="relative h-64 bg-gradient-to-r from-municipal-green to-municipal-teal flex items-center justify-center">
      <div class="absolute inset-0 bg-black opacity-20"></div>
      <div class="relative text-center text-white z-10">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">TU CIUDAD</h1>
        <p class="text-xl text-green-100">Descubre y conecta con Sabinas Hidalgo</p>
      </div>
    </section>

    <!-- Quick Navigation -->
    <section class="py-8 bg-white border-b">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-center space-x-8">
          <a class="text-municipal-blue hover:text-blue-700 font-medium px-4 py-2 rounded-full border border-municipal-blue hover:bg-blue-50 transition duration-300" href="#directorio">
            <i class="fas fa-store mr-2"></i>Directorio de Negocios
          </a>
          <a class="text-municipal-teal hover:text-teal-700 font-medium px-4 py-2 rounded-full border border-municipal-teal hover:bg-teal-50 transition duration-300" href="#turismo">
            <i class="fas fa-map-marked-alt mr-2"></i>Lugares Tur√≠sticos
          </a>
          <a class="text-municipal-green hover:text-green-700 font-medium px-4 py-2 rounded-full border border-municipal-green hover:bg-green-50 transition duration-300" href="#eventos">
            <i class="fas fa-calendar-alt mr-2"></i>Eventos Locales
          </a>
        </div>
      </div>
    </section>

    <!-- Business Directory -->
    <section class="py-16 bg-gray-50" id="directorio">
      <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-municipal-blue mb-4">DIRECTORIO DE NEGOCIOS</h2>
          <p class="text-gray-600 mb-8">Apoya a los emprendedores locales de Sabinas Hidalgo</p>
          <button class="bg-municipal-blue hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full transition duration-300 mb-8" id="registerBusinessBtn">
            <i class="fas fa-plus mr-2"></i>Registrar mi Negocio
          </button>
        </div>
        <div class="max-w-4xl mx-auto mb-8">
          <div class="flex flex-col md:flex-row gap-4">
            <input id="businessSearch" type="text" placeholder="Buscar negocios..." class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-municipal-blue"/>
            <select id="categoryFilter" class="px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-municipal-blue">
              <option value="">Todas las categor√≠as</option>
              <option value="restaurante">Restaurantes</option>
              <option value="tienda">Tiendas</option>
              <option value="servicio">Servicios</option>
              <option value="salud">Salud</option>
              <option value="educacion">Educaci√≥n</option>
            </select>
          </div>
        </div>
        <div id="businessGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Cards via JS -->
        </div>
      </div>
    </section>

    <!-- Tourist Places -->
    <section class="py-16 bg-white" id="turismo">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-municipal-blue text-center mb-12">LUGARES TUR√çSTICOS</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
          <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-2xl p-8 text-white relative overflow-hidden">
            <div class="absolute top-4 right-4 text-6xl opacity-20">üåä</div>
            <h3 class="text-2xl font-bold mb-4">PARQUE LA TURBINA</h3>
            <p class="text-green-100 mb-6">Hermoso parque natural con cascadas y √°reas recreativas. Perfecto para un d√≠a familiar rodeado de naturaleza y agua cristalina.</p>
            <div class="space-y-2 text-sm text-green-100">
              <p><i class="fas fa-map-marker-alt mr-2"></i>Carretera a Lampazos, Km 8</p>
              <p><i class="fas fa-clock mr-2"></i>Todos los d√≠as: 8:00-18:00</p>
              <p><i class="fas fa-ticket-alt mr-2"></i>Entrada gratuita</p>
            </div>
            <button class="mt-6 bg-white text-green-600 px-6 py-2 rounded-full font-semibold hover:bg-green-50 transition duration-300">Ver m√°s detalles</button>
          </div>
          <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-8 text-white relative overflow-hidden">
            <div class="absolute top-4 right-4 text-6xl opacity-20">üíß</div>
            <h3 class="text-2xl font-bold mb-4">PARQUE OJO DE AGUA</h3>
            <p class="text-blue-100 mb-6">Manantial natural de aguas termales con propiedades curativas. Un oasis de tranquilidad y relajaci√≥n en medio del desierto.</p>
            <div class="space-y-2 text-sm text-blue-100">
              <p><i class="fas fa-map-marker-alt mr-2"></i>Ejido Ojo de Agua, 15 km al norte</p>
              <p><i class="fas fa-clock mr-2"></i>Todos los d√≠as: 7:00-19:00</p>
              <p><i class="fas fa-ticket-alt mr-2"></i>$50 por persona</p>
            </div>
            <button class="mt-6 bg-white text-blue-600 px-6 py-2 rounded-full font-semibold hover:bg-blue-50 transition duration-300">Ver m√°s detalles</button>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300">
            <div class="bg-gradient-to-r from-orange-400 to-red-500 h-32 flex items-center justify-center">
              <span class="text-white text-5xl">‚õ∞Ô∏è</span>
            </div>
            <div class="p-6">
              <h3 class="font-bold text-municipal-blue text-lg mb-2">CERRO LA ERMITA</h3>
              <p class="text-gray-600 text-sm mb-4">Mirador natural con vistas panor√°micas de la ciudad. Ideal para senderismo y fotograf√≠a.</p>
              <div class="text-xs text-gray-500 space-y-1">
                <p><i class="fas fa-hiking mr-2"></i>Dificultad: Moderada</p>
                <p><i class="fas fa-clock mr-2"></i>2-3 horas de caminata</p>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300">
            <div class="bg-gradient-to-r from-municipal-blue to-blue-600 h-32 flex items-center justify-center">
              <span class="text-white text-5xl">üèõÔ∏è</span>
            </div>
            <div class="p-6">
              <h3 class="font-bold text-municipal-blue text-lg mb-2">PLAZA DE ARMAS</h3>
              <p class="text-gray-600 text-sm mb-4">Coraz√≥n hist√≥rico de la ciudad con arquitectura colonial y eventos culturales.</p>
              <div class="text-xs text-gray-500 space-y-1">
                <p><i class="fas fa-camera mr-2"></i>Perfecto para fotos</p>
                <p><i class="fas fa-music mr-2"></i>Eventos los fines de semana</p>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300">
            <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-32 flex items-center justify-center">
              <span class="text-white text-5xl">‚õ™</span>
            </div>
            <div class="p-6">
              <h3 class="font-bold text-municipal-blue text-lg mb-2">TEMPLO DE SAN JOS√â</h3>
              <p class="text-gray-600 text-sm mb-4">Iglesia hist√≥rica del siglo XVIII con hermosa arquitectura barroca mexicana.</p>
              <div class="text-xs text-gray-500 space-y-1">
                <p><i class="fas fa-history mr-2"></i>Patrimonio hist√≥rico</p>
                <p><i class="fas fa-pray mr-2"></i>Misas diarias</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Local Events -->
    <section class="py-16 bg-gray-50" id="eventos">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-municipal-blue text-center mb-12">EVENTOS LOCALES</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-municipal-pink rounded-full flex items-center justify-center text-white text-xl mr-4">üé™</div>
              <div>
                <h3 class="font-bold text-municipal-blue">Feria de San Jos√©</h3>
                <p class="text-sm text-municipal-pink font-semibold">19 de Marzo</p>
              </div>
            </div>
            <p class="text-gray-600 text-sm">Celebraci√≥n patronal con juegos mec√°nicos, comida t√≠pica y eventos culturales.</p>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-municipal-green rounded-full flex items-center justify-center text-white text-xl mr-4">üåΩ</div>
              <div>
                <h3 class="font-bold text-municipal-blue">Festival del Elote</h3>
                <p class="text-sm text-municipal-green font-semibold">Agosto</p>
              </div>
            </div>
            <p class="text-gray-600 text-sm">Celebraci√≥n de la cosecha con degustaci√≥n de platillos tradicionales a base de ma√≠z.</p>
          </div>
          <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-municipal-teal rounded-full flex items-center justify-center text-white text-xl mr-4">üé≠</div>
              <div>
                <h3 class="font-bold text-municipal-blue">Noche de Talentos</h3>
                <p class="text-sm text-municipal-teal font-semibold">Primer s√°bado del mes</p>
              </div>
            </div>
            <p class="text-gray-600 text-sm">Espect√°culo mensual donde los ciudadanos muestran sus talentos art√≠sticos.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-municipal-blue text-white py-12">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <h3 class="font-bold text-xl mb-4">CONTACTO</h3>
            <p class="mb-2">üìç Palacio Municipal, Centro</p>
            <p class="mb-2">üìû (824) 123-4567</p>
            <p class="mb-2">‚úâÔ∏è contacto@sabinashidalgo.gob.mx</p>
          </div>
          <div>
            <h3 class="font-bold text-xl mb-4">HORARIOS</h3>
            <p class="mb-2">Lunes a Viernes: 8:00 - 16:00 hrs</p>
            <p class="mb-2">S√°bados: 9:00 - 13:00 hrs</p>
            <p class="mb-2">Mi√©rcoles Ciudadano: 11:30 - 13:30 hrs</p>
          </div>
          <div>
            <h3 class="font-bold text-xl mb-4">S√çGUENOS</h3>
            <div class="flex space-x-4">
              <a class="text-2xl hover:text-blue-300" href="#"><i class="fab fa-facebook"></i></a>
              <a class="text-2xl hover:text-blue-300" href="#"><i class="fab fa-twitter"></i></a>
              <a class="text-2xl hover:text-blue-300" href="#"><i class="fab fa-instagram"></i></a>
              <a class="text-2xl hover:text-blue-300" href="#"><i class="fab fa-youtube"></i></a>
            </div>
          </div>
        </div>
        <div class="border-t border-blue-400 mt-8 pt-8 text-center">
          <p>¬© 2024 Gobierno Municipal de Sabinas Hidalgo, Nuevo Le√≥n. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- ========================= WIZARD MODAL ========================= -->
    <div id="business-wizard-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-200">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold text-gray-800">Registro de Negocio</h3>
            <button class="text-gov-gray hover:text-gray-800 transition duration-200" onclick="closeBusinessWizard()">
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <!-- [STRUCTURE] Dynamic step indicators -->
          <div id="wizard-indicators" class="flex items-center space-x-4"></div>
        </div>

        <!-- Content -->
        <div class="p-6">
          <!-- [STRUCTURE] Steps containers (rendered dynamically) -->
          <div id="wizard-steps-container"></div>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-gray-200 flex justify-between">
          <button id="wizard-prev-btn" class="px-6 py-2 border border-gray-300 rounded-lg text-gov-gray hover:bg-gray-50 transition duration-200 hidden" onclick="previousStep()">
            <i class="fas fa-arrow-left mr-2"></i>Anterior
          </button>
          <div class="flex space-x-3">
            <button class="px-6 py-2 border border-gray-300 rounded-lg text-gov-gray hover:bg-gray-50 transition duration-200" onclick="closeBusinessWizard()">Cancelar</button>
            <button id="wizard-next-btn" class="px-6 py-2 bg-gov-blue text-white rounded-lg hover:bg-blue-700 transition duration-200" onclick="nextStep()">
              Siguiente <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========================= SCRIPTS ========================= -->
    <script>
      // Small animations helper
      const style = document.createElement("style");
      style.textContent = `
        @keyframes fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0);} }
        .animate-fade-in { animation: fade-in 0.8s ease-out; }
      `;
      document.head.appendChild(style);

      // ================= CITY LIST: data + rendering =================
      /** Demo data */
      let businesses = [
        { id: 1, nombre: "Pizzer√≠a Don Carlos", categoria: "restaurante", giroNombre: "Deliciosas pizzas artesanales y comida italiana. Servicio a domicilio disponible.", descripcion: "Deliciosas pizzas artesanales y comida italiana. Servicio a domicilio disponible.", direccion: "Calle Hidalgo #123, Centro", telefono: "(824) 555-0101", horario: "Lun-Dom: 12:00-22:00" },
        { id: 2, nombre: "Boutique Elegancia", categoria: "tienda", giroNombre: "Ropa de moda para toda la familia. Tendencias a precios accesibles.", descripcion: "Ropa de moda para toda la familia. Tendencias a precios accesibles.", direccion: "Av. Ju√°rez #456, Centro", telefono: "(824) 555-0102", horario: "Lun-S√°b: 9:00-19:00" },
        { id: 3, nombre: "Taller Mec√°nico Rodr√≠guez", categoria: "servicio", giroNombre: "Reparaci√≥n y mantenimiento de veh√≠culos. 25 a√±os de experiencia.", descripcion: "Reparaci√≥n y mantenimiento de veh√≠culos. 25 a√±os de experiencia.", direccion: "Calle Morelos #789, Col. Industrial", telefono: "(824) 555-0103", horario: "Lun-Vie: 8:00-18:00" },
        { id: 4, nombre: "Farmacia San Jos√©", categoria: "salud", giroNombre: "Medicamentos, productos de salud y belleza. Servicio 24 horas.", descripcion: "Medicamentos, productos de salud y belleza. Servicio 24 horas.", direccion: "Plaza Principal #12, Centro", telefono: "(824) 555-0104", horario: "" },
        { id: 5, nombre: "Academia de Ingl√©s Global", categoria: "educacion", giroNombre: "Cursos de ingl√©s para todas las edades. Certificaciones internacionales.", descripcion: "Cursos de ingl√©s para todas las edades. Certificaciones internacionales.", direccion: "Calle Allende #234, Centro", telefono: "(824) 555-0105", horario: "Lun-Vie: 15:00-21:00" },
        { id: 6, nombre: "Caf√© Central", categoria: "restaurante", giroNombre: "El mejor caf√© de la regi√≥n. Desayunos, postres y ambiente acogedor.", descripcion: "El mejor caf√© de la regi√≥n. Desayunos, postres y ambiente acogedor.", direccion: "Plaza de Armas #1, Centro", telefono: "(824) 555-0106", horario: "Lun-Dom: 7:00-22:00" },
      ];

      function renderBusinesses(list = businesses) {
        const grid = document.getElementById("businessGrid");
        if (!grid) return;
        grid.innerHTML = list.map((b) => {
          const catLabel = b.categoriaNombre || {
            restaurante: "Restaurante",
            tienda: "Tienda",
            servicio: "Servicio",
            salud: "Salud",
            educacion: "Educaci√≥n",
          }[b.categoria] || b.giroNombre || "";
          return `
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300 animate-fade-in" data-category="${b.categoria || ""}">
              <div class="flex items-center mb-4">
                <div class="w-12 h-12 bg-municipal-blue/10 rounded-full flex items-center justify-center text-xl mr-4">
                  <i class="fas fa-store text-municipal-blue"></i>
                </div>
                <div>
                  <h3 class="font-bold text-municipal-blue">${b.nombre || ""}</h3>
                  <p class="text-sm text-gray-600">${catLabel || ""}</p>
                </div>
              </div>
              <p class="text-gray-600 text-sm mb-4">${b.descripcion || ""}</p>
              <div class="text-sm text-gray-700 space-y-1">
                ${b.direccion ? `<p><i class="fas fa-map-marker-alt mr-2"></i>${b.direccion}</p>` : ""}
                ${b.telefono ? `<p><i class="fas fa-phone mr-2"></i>${b.telefono}</p>` : ""}
                ${b.horario ? `<p><i class="fas fa-clock mr-2"></i>${b.horario}</p>` : ""}
              </div>
            </div>`;
        }).join("");
      }

      function attachCityFilters() {
        const search = document.getElementById("businessSearch");
        const filter = document.getElementById("categoryFilter");
        function apply() {
          const q = (search?.value || "").toLowerCase();
          const cat = filter?.value || "";
          const filtered = businesses.filter((b) => {
            const matchesCat = !cat || b.categoria === cat;
            const blob = `${b.nombre} ${b.descripcion} ${b.direccion} ${b.giroNombre}`.toLowerCase();
            const matchesQ = !q || blob.includes(q);
            return matchesCat && matchesQ;
          });
          renderBusinesses(filtered);
        }
        search && search.addEventListener("input", apply);
        filter && filter.addEventListener("change", apply);
        apply();
      }

      // Smooth scroll
      document.querySelectorAll('a[href^="#"]').forEach((a) => {
        a.addEventListener("click", (e) => {
          const target = document.querySelector(a.getAttribute("href"));
          if (!target) return;
          e.preventDefault();
          target.scrollIntoView({ behavior: "smooth", block: "start" });
        });
      });

      // Tourist details alert
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (btn && btn.textContent.includes("Ver m√°s detalles")) {
          const placeName = btn.closest("div").querySelector("h3")?.textContent || "el lugar";
          alert(`M√°s informaci√≥n sobre ${placeName} pr√≥ximamente disponible en nuestra app m√≥vil.`);
        }
      });

      // ===================== WIZARD: data-driven structure =====================
      /** [STRUCTURE] Servicios generales base: llaves -> etiqueta + icono */
      const GENERAL_SERVICES_CATALOG = {
        domicilio:   { label: "Servicio a domicilio", icon: "fas fa-truck" },
        separado:    { label: "Servicio de apartado/separado", icon: "fas fa-bookmark" },
        credito:     { label: "Venta a cr√©dito", icon: "fas fa-credit-card" },
        whatsapp:    { label: "Pedidos por WhatsApp", icon: "fab fa-whatsapp" },
        facebook:    { label: "Ventas por Facebook", icon: "fab fa-facebook" },
        efectivo:    { label: "Acepta solo efectivo", icon: "fas fa-money-bill-wave" },
        tarjetas:    { label: "Acepta tarjetas", icon: "fas fa-credit-card" },
        transferencia:{ label: "Acepta transferencias", icon: "fas fa-mobile-alt" },
        mayoreo:     { label: "Venta al mayoreo", icon: "fas fa-boxes" },
        menudeo:     { label: "Venta al menudeo", icon: "fas fa-shopping-basket" },
        instalacion: { label: "Servicio de instalaci√≥n", icon: "fas fa-tools" },
        garantia:    { label: "Ofrece garant√≠a", icon: "fas fa-shield-alt" },
        reparacion:  { label: "Servicio de reparaci√≥n", icon: "fas fa-wrench" },
        mantenimiento:{ label: "Servicio de mantenimiento", icon: "fas fa-cogs" },
        estacionamiento:{ label: "Estacionamiento disponible", icon: "fas fa-parking" },
        wifi:        { label: "WiFi gratuito", icon: "fas fa-wifi" },
        aire:        { label: "Aire acondicionado", icon: "fas fa-snowflake" },
        accesible:   { label: "Acceso para discapacitados", icon: "fas fa-wheelchair" },
      };

      /** [STRUCTURE] Config de categor√≠as y subcategor√≠as
          - Puedes a√±adir m√°s top categories
          - Cada categor√≠a puede definir generalServices (array de ids)
          - Cada subcategor√≠a puede sobre-escribir con su propio generalServices
      */
      const BUSINESS_CATEGORIES = {
        alimentos: {
          id: "alimentos",
          name: "Alimentos y Bebidas",
          icon: "fas fa-utensils",
          color: "bg-red-500",
          generalServices: ["domicilio","whatsapp","efectivo","tarjetas","estacionamiento","wifi","aire","accesible"],
          subcategories: [
            { id: "restaurante", name: "Restaurante", description: "Mesas y atenci√≥n al cliente, servicio completo de alimentos y bebidas." },
            { id: "servicar", name: "Servicar", description: "Comida r√°pida con atenci√≥n desde el auto." , generalServices: ["domicilio","efectivo","tarjetas","aire"]},
            { id: "fondita", name: "Fondita / Cocina econ√≥mica", description: "Comida casera a precios accesibles con men√∫ del d√≠a." },
            { id: "comida_casera", name: "Comidas caseras por d√≠as", description: "Platillos preparados en casa ciertos d√≠as, por encargo o entrega.", generalServices:["whatsapp","domicilio","efectivo"] },
            { id: "comida_ambulante", name: "Comida ambulante / Puesto", description: "Venta en v√≠a p√∫blica itinerante o en punto fijo sin local.", generalServices:["efectivo","whatsapp"] },
            { id: "food_truck", name: "Carro de comida / Food truck", description: "Unidad m√≥vil para preparar y vender alimentos.", generalServices:["efectivo","tarjetas"] },
            { id: "panaderia", name: "Panader√≠a / Pasteler√≠a", description: "Pan, pasteles y reposter√≠a de producci√≥n local." },
            { id: "otro_alimentos", name: "Otro", description: "Otro tipo de negocio de alimentos y bebidas." },
          ],
        },
        // Ejemplos preparados para crecer sin romper UI (se muestran como "Pr√≥ximamente")
        comercio: { id:"comercio", name:"Comercio y Ventas", icon:"fas fa-shopping-bag", color:"bg-orange-500", generalServices:["tarjetas","transferencia","mayoreo","menudeo","garantia"] , subcategories:[] },
        servicios: { id:"servicios", name:"Servicios", icon:"fas fa-tools", color:"bg-blue-500", generalServices:["garantia","reparacion","mantenimiento","whatsapp","transferencia"], subcategories:[] },
        salud: { id:"salud", name:"Salud y Bienestar", icon:"fas fa-heartbeat", color:"bg-green-500", generalServices:["tarjetas","transferencia","accesible"], subcategories:[] },
        educacion: { id:"educacion", name:"Educaci√≥n, Cultura y Entretenimiento", icon:"fas fa-graduation-cap", color:"bg-purple-500", generalServices:["tarjetas","transferencia","wifi","accesible"], subcategories:[] },
      };

      // Estado del wizard
      let wizardData = {};
      let currentWizardStepIdx = 0;

      // [STRUCTURE] Contenido UI (templates) reutilizables
      const TEMPLATES = {
        generalInfo: () => `
          <h4 class="text-xl font-bold text-gray-800 mb-6">Informaci√≥n General del Negocio</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Negocio *</label>
              <input id="business-name" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Propietario *</label>
              <input id="business-owner" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tel√©fono *</label>
              <input id="business-phone" type="tel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
              <input id="business-email" type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">Direcci√≥n *</label>
              <input id="business-address" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Horario de Apertura</label>
              <input id="business-open" type="time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Horario de Cierre</label>
              <input id="business-close" type="time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
            </div>
          </div>
        `,
        categories: () => {
          const cards = Object.values(BUSINESS_CATEGORIES).map(c => {
            const disabled = c.id !== "alimentos"; // mantener visual actual: solo "Alimentos" habilitado
            return `
              <div class="category-card p-4 border-2 border-gray-200 rounded-lg ${disabled ? "opacity-50 cursor-not-allowed" : "cursor-pointer hover:border-gov-blue"} transition duration-200"
                   ${disabled ? "" : `onclick="selectCategory('${c.id}')"`}>
                <div class="text-center">
                  <div class="${c.color} bg-opacity-10 p-4 rounded-lg mx-auto mb-3 w-20 h-20 flex items-center justify-center">
                    <i class="${c.icon} text-3xl text-gray-700"></i>
                  </div>
                  <h6 class="font-medium text-gray-800">${c.name}</h6>
                  ${disabled ? `<p class="text-xs text-gray-500 mt-1">Pr√≥ximamente</p>` : ""}
                </div>
              </div>`;
          }).join("");
          return `
            <h4 class="text-xl font-bold text-gray-800 mb-6">Giro del Negocio</h4>
            <div id="business-types" class="space-y-6">
              <div id="category-selection">
                <h5 class="font-bold text-gray-800 mb-4">Selecciona la categor√≠a principal de tu negocio:</h5>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">${cards}</div>
              </div>
              <div id="subcategory-selection" class="hidden">
                <div class="flex items-center mb-4">
                  <button type="button" onclick="goBackToCategories()" class="text-gov-blue hover:text-blue-700 mr-4"><i class="fas fa-arrow-left mr-2"></i>Volver a categor√≠as</button>
                  <h5 class="font-bold text-gray-800" id="selected-category-title"></h5>
                </div>
                <div id="subcategory-grid" class="grid grid-cols-1 gap-4"></div>
                <div id="custom-subcategory" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Especifica tu tipo de negocio:</label>
                  <input type="text" id="custom-business-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent" placeholder="Ej: Venta de jugos naturales, Cafeter√≠a, etc.">
                </div>
              </div>

              <!-- [STRUCTURE] Servicios generales din√°micos por categor√≠a/subcategor√≠a -->
              <div id="general-services-section" class="hidden pt-6 border-t border-gray-200">
                <h5 class="font-bold text-gray-800 mb-4">Servicios Generales (selecciona los que apliquen)</h5>
                <div id="general-services-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
              </div>
            </div>
          `;
        },
        specificDetails: () => `
          <h4 class="text-xl font-bold text-gray-800 mb-6">Detalles Espec√≠ficos</h4>
          <div id="specific-details-content"></div>
        `,
        confirmation: () => `
          <h4 class="text-xl font-bold text-gray-800 mb-6">Confirmaci√≥n de Datos</h4>
          <div class="bg-gray-50 rounded-lg p-6" id="confirmation-content"></div>
        `,
      };

      /** [STRUCTURE] Definici√≥n de pasos. Para agregar m√°s, empuja objetos con mismo formato. */
      const WIZARD_STEPS = [
        {
          key: "general",
          label: "Informaci√≥n General",
          render: TEMPLATES.generalInfo,
          validate: () => {
            const requiredIds = ["business-name","business-owner","business-phone","business-address"];
            for (const id of requiredIds) {
              const el = document.getElementById(id);
              if (!el || !el.value?.trim()) { alert("Completa los campos obligatorios."); return false; }
            }
            return true;
          },
          save: () => {
            wizardData.nombre = document.getElementById("business-name")?.value?.trim();
            wizardData.propietario = document.getElementById("business-owner")?.value?.trim();
            wizardData.telefono = document.getElementById("business-phone")?.value?.trim();
            wizardData.email = document.getElementById("business-email")?.value?.trim();
            wizardData.direccion = document.getElementById("business-address")?.value?.trim();
            const o = document.getElementById("business-open")?.value;
            const c = document.getElementById("business-close")?.value;
            wizardData.horario = o && c ? `${o} - ${c}` : "";
          },
        },
        {
          key: "giro",
          label: "Giro y Servicios",
          render: TEMPLATES.categories,
          validate: () => {
            if (!wizardData.categoria || !wizardData.giro) { alert("Selecciona una categor√≠a y un giro."); return false; }
            return true;
          },
          save: () => {
            // si subcategor√≠a "otro", usa el texto custom
            if (wizardData.giro?.includes("otro")) {
              const custom = document.getElementById("custom-business-type")?.value?.trim();
              if (custom) wizardData.giroNombre = custom;
            }
          },
          onEnter: () => {
            // inicializa selecci√≥n si ya exist√≠a
            if (wizardData.categoria) selectCategory(wizardData.categoria, true);
            if (wizardData.giro) {
              const firstCard = document.querySelector(`[data-subcat="${wizardData.giro}"]`);
              firstCard && firstCard.classList.add("ring-2","ring-gov-blue","bg-blue-50");
            }
          }
        },
        {
          key: "detalles",
          label: "Detalles Espec√≠ficos",
          render: TEMPLATES.specificDetails,
          validate: () => true,
          onEnter: () => populateSpecificDetails(),
        },
        {
          key: "confirmacion",
          label: "Confirmaci√≥n",
          render: TEMPLATES.confirmation,
          validate: () => true,
          onEnter: () => populateConfirmation(),
        },
      ];

      // ---------- Wizard plumbing (render, indicators, nav) ----------
      function openBusinessWizard() {
        wizardData = {};
        currentWizardStepIdx = 0;
        document.getElementById("business-wizard-modal")?.classList.remove("hidden");
        renderWizardShell();
        renderCurrentStep();
        updateNavButtons();
      }
      function closeBusinessWizard() {
        document.getElementById("business-wizard-modal")?.classList.add("hidden");
      }
      function previousStep() {
        if (currentWizardStepIdx > 0) {
          currentWizardStepIdx--;
          renderCurrentStep();
          updateNavButtons();
        }
      }
      function nextStep() {
        const step = WIZARD_STEPS[currentWizardStepIdx];
        if (step.validate && !step.validate()) return;
        step.save && step.save();
        if (currentWizardStepIdx < WIZARD_STEPS.length - 1) {
          currentWizardStepIdx++;
          renderCurrentStep();
          updateNavButtons();
        } else {
          saveBusiness();
        }
      }
      function renderWizardShell() {
        // Indicators
        const indicators = document.getElementById("wizard-indicators");
        const total = WIZARD_STEPS.length;
        const indicatorsHtml = WIZARD_STEPS.map((s, idx) => {
          const isFirst = idx === 0;
          const circle = `
            <div class="flex items-center" id="step-${idx+1}-indicator">
              <div class="w-8 h-8 ${idx===0?'bg-gov-blue text-white':'bg-gray-300 text-gray-600'} rounded-full flex items-center justify-center text-sm font-bold">${idx+1}</div>
              <span class="ml-2 text-sm font-medium ${idx===0?'text-gov-blue':'text-gray-600'}">${s.label}</span>
            </div>`;
          const bar = idx < total - 1 ? `
            <div class="flex-1 h-1 bg-gray-200 rounded">
              <div class="h-1 bg-gov-blue rounded transition-all duration-300" style="width: ${((idx+1)/total)*100}%"></div>
            </div>` : "";
          return circle + bar;
        }).join("");
        indicators.innerHTML = indicatorsHtml;

        // Steps container
        const container = document.getElementById("wizard-steps-container");
        container.innerHTML = WIZARD_STEPS.map((s, idx) => `
          <div class="wizard-step ${idx===0?'':'hidden'}" id="wizard-step-${idx+1}">
            ${s.render()}
          </div>`).join("");
      }
      function renderCurrentStep() {
        document.querySelectorAll(".wizard-step").forEach((el, i) => {
          if (i === currentWizardStepIdx) el.classList.remove("hidden");
          else el.classList.add("hidden");
        });
        // indicators active state
        WIZARD_STEPS.forEach((_, i) => {
          const indicator = document.getElementById(`step-${i+1}-indicator`);
          if (!indicator) return;
          const circle = indicator.querySelector("div");
          const text = indicator.querySelector("span");
          if (i <= currentWizardStepIdx) {
            circle?.classList.remove("bg-gray-300","text-gray-600");
            circle?.classList.add("bg-gov-blue","text-white");
            text?.classList.add("text-gov-blue");
            text?.classList.remove("text-gray-600");
          } else {
            circle?.classList.add("bg-gray-300","text-gray-600");
            circle?.classList.remove("bg-gov-blue","text-white");
            text?.classList.remove("text-gov-blue");
            text?.classList.add("text-gray-600");
          }
        });
        // step hook
        const step = WIZARD_STEPS[currentWizardStepIdx];
        step.onEnter && step.onEnter();
      }
      function updateNavButtons() {
        const prev = document.getElementById("wizard-prev-btn");
        const next = document.getElementById("wizard-next-btn");
        if (prev) currentWizardStepIdx === 0 ? prev.classList.add("hidden") : prev.classList.remove("hidden");
        if (next) next.innerHTML = currentWizardStepIdx === WIZARD_STEPS.length - 1
          ? '<i class="fas fa-check mr-2"></i>Registrar Negocio'
          : 'Siguiente <i class="fas fa-arrow-right ml-2"></i>';
      }

      // ---------- Category/Subcategory selection + services binding ----------
      function selectCategory(categoryId, silent = false) {
        const category = BUSINESS_CATEGORIES[categoryId];
        if (!category) return;
        wizardData.categoria = categoryId;
        wizardData.categoriaNombre = category.name;

        // Toggle sections
        document.getElementById("category-selection")?.classList.add("hidden");
        document.getElementById("subcategory-selection")?.classList.remove("hidden");
        document.getElementById("selected-category-title").textContent = category.name;

        // Render subcategories
        const grid = document.getElementById("subcategory-grid");
        grid.innerHTML = category.subcategories.map(s => `
          <div class="subcategory-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-gov-blue transition duration-200"
               data-subcat="${s.id}"
               onclick="selectSubcategory('${s.id}','${s.name}')">
            <div class="flex items-start space-x-4">
              <div class="flex-shrink-0"><div class="bg-gov-blue bg-opacity-10 p-3 rounded-lg"><i class="fas fa-list text-gov-blue text-xl"></i></div></div>
              <div class="flex-1"><h6 class="font-medium text-gray-800 mb-2">${s.name}</h6><p class="text-sm text-gray-600">${s.description||""}</p></div>
            </div>
          </div>
        `).join("");

        // Render servicios generales dependientes
        renderGeneralServices(category.generalServices);

        // Show services panel
        document.getElementById("general-services-section")?.classList.remove("hidden");

        if (!silent) {
          // limpia selecci√≥n previa
          delete wizardData.giro;
          delete wizardData.giroNombre;
        }
      }

      function goBackToCategories() {
        document.getElementById("category-selection")?.classList.remove("hidden");
        document.getElementById("subcategory-selection")?.classList.add("hidden");
        document.getElementById("general-services-section")?.classList.add("hidden");
        delete wizardData.categoria;
        delete wizardData.categoriaNombre;
        delete wizardData.giro;
        delete wizardData.giroNombre;
        wizardData.serviciosGenerales = [];
      }

      function selectSubcategory(id, name) {
        document.querySelectorAll(".subcategory-card").forEach((c)=>c.classList.remove("ring-2","ring-gov-blue","bg-blue-50"));
        event.target.closest(".subcategory-card").classList.add("ring-2","ring-gov-blue","bg-blue-50");
        wizardData.giro = id;
        wizardData.giroNombre = name;

        // Si la subcategor√≠a define servicios generales, sobre-escribe
        const cat = BUSINESS_CATEGORIES[wizardData.categoria];
        const sub = cat?.subcategories?.find(s => s.id === id);
        if (sub?.generalServices?.length) {
          renderGeneralServices(sub.generalServices);
        } else {
          // vuelve a los de la categor√≠a
          renderGeneralServices(cat?.generalServices || []);
        }

        // Mostrar u ocultar input "otro"
        const custom = document.getElementById("custom-subcategory");
        if (id.includes("otro")) custom?.classList.remove("hidden");
        else {
          custom?.classList.add("hidden");
          const ci = document.getElementById("custom-business-type");
          if (ci) ci.value = "";
        }
      }

      function renderGeneralServices(keys = []) {
        const wrap = document.getElementById("general-services-grid");
        if (!wrap) return;
        const html = keys.map(k => {
          const meta = GENERAL_SERVICES_CATALOG[k];
          if (!meta) return "";
          const checked = (wizardData.serviciosGenerales || []).includes(k) ? "checked" : "";
          return `
            <label class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <input type="checkbox" class="general-service-checkbox text-gov-blue focus:ring-gov-blue" value="${k}" ${checked} onchange="updateGeneralServices()">
              <i class="${meta.icon} text-gov-blue w-5"></i>
              <span class="text-sm text-gray-700">${meta.label}</span>
            </label>`;
        }).join("");
        wrap.innerHTML = html;
      }

      function updateGeneralServices() {
        const checks = [...document.querySelectorAll(".general-service-checkbox")];
        wizardData.serviciosGenerales = checks.filter(c=>c.checked).map(c=>c.value);
      }

      // ---------- Step 3 content ----------
      function populateSpecificDetails() {
        const container = document.getElementById("specific-details-content");
        if (!container) return;
        if (wizardData.giro === "restaurante") {
          container.innerHTML = `
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Tipo de Comida</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  ${["Mexicana","Hamburguesas","Pizza","Mariscos","Tacos","Comida R√°pida","Antojitos","Internacional"].map(t =>
                    `<button type="button" onclick="toggleFoodType('${t}')" class="food-type-btn p-3 border border-gray-300 rounded-lg hover:border-gov-blue hover:bg-blue-50 transition duration-200 text-sm" data-type="${t}">${t}</button>`
                  ).join("")}
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Men√∫ Principal (opcional)</label>
                <div class="space-y-4">
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                      <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Nombre del Platillo *</label>
                        <input type="text" id="menu-item-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent text-sm">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Precio *</label>
                        <input type="number" id="menu-item-price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent text-sm">
                      </div>
                    </div>
                    <button type="button" onclick="addMenuItem()" class="w-full px-4 py-2 bg-gov-blue text-white rounded-lg hover:bg-blue-700 transition duration-200 text-sm">
                      <i class="fas fa-plus mr-2"></i>Agregar Platillo
                    </button>
                  </div>
                  <div id="menu-list" class="space-y-3"></div>
                </div>
              </div>
            </div>`;
        } else {
          container.innerHTML = '<p class="text-gray-600">No se requieren detalles espec√≠ficos para este giro.</p>';
        }
      }
      function toggleFoodType(tipo) {
        wizardData.tiposComida = wizardData.tiposComida || [];
        const idx = wizardData.tiposComida.indexOf(tipo);
        const btns = document.querySelectorAll(".food-type-btn");
        if (idx >= 0) wizardData.tiposComida.splice(idx, 1);
        else wizardData.tiposComida.push(tipo);
        btns.forEach((b) => { if (b.dataset.type === tipo) b.classList.toggle("bg-blue-50"); });
      }
      function addMenuItem() {
        const name = document.getElementById("menu-item-name")?.value?.trim();
        const price = parseFloat(document.getElementById("menu-item-price")?.value || "0");
        if (!name || !price) { alert("Completa nombre y precio"); return; }
        wizardData.menu = wizardData.menu || [];
        wizardData.menu.push({ nombre: name, precio: price });
        document.getElementById("menu-list").innerHTML = wizardData.menu.map(m => `
          <div class="flex justify-between bg-white border p-3 rounded">
            <span>${m.nombre}</span><span>$ ${m.precio.toFixed(2)}</span>
          </div>`).join("");
      }

      // ---------- Step 4: confirmation ----------
      function populateConfirmation() {
        const div = document.getElementById("confirmation-content");
        if (!div) return;
        div.innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><p class="text-sm text-gray-500">Nombre</p><p class="font-medium">${wizardData.nombre || ""}</p></div>
            <div><p class="text-sm text-gray-500">Propietario</p><p class="font-medium">${wizardData.propietario || ""}</p></div>
            <div><p class="text-sm text-gray-500">Tel√©fono</p><p class="font-medium">${wizardData.telefono || ""}</p></div>
            <div><p class="text-sm text-gray-500">Email</p><p class="font-medium">${wizardData.email || ""}</p></div>
            <div class="md:col-span-2"><p class="text-sm text-gray-500">Direcci√≥n</p><p class="font-medium">${wizardData.direccion || ""}</p></div>
            <div><p class="text-sm text-gray-500">Categor√≠a</p><p class="font-medium">${wizardData.categoriaNombre || ""}</p></div>
            <div><p class="text-sm text-gray-500">Giro</p><p class="font-medium">${wizardData.giroNombre || wizardData.giro || ""}</p></div>
          </div>`;
      }

      // ---------- Persist into list ----------
      function saveBusiness() {
        const id = Date.now();
        const nuevo = {
          id,
          nombre: wizardData.nombre,
          propietario: wizardData.propietario,
          categoria: wizardData.categoria || "restaurante",
          categoriaNombre: wizardData.categoriaNombre,
          giro: wizardData.giro,
          giroNombre: wizardData.giroNombre,
          telefono: wizardData.telefono,
          email: wizardData.email,
          direccion: wizardData.direccion,
          horario: wizardData.horario,
          descripcion: wizardData.descripcion || "",
        };
        businesses.unshift(nuevo);
        renderBusinesses();
        closeBusinessWizard();
      }

      // ---------- Hook main button + initial render ----------
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("registerBusinessBtn")?.addEventListener("click", function (e) {
          e.preventDefault();
          openBusinessWizard();
        });
        renderBusinesses();
        attachCityFilters();
      });
    </script>
  </body>
</html>
