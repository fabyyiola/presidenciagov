<!-- Direcciones.html -->
<section class="section-content p-6">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h2 class="text-3xl font-bold text-gray-800 mb-2">Direcciones</h2>
      <p class="text-gov-gray">Gestión de las direcciones municipales</p>
    </div>
    <button id="dir-add" class="bg-gov-green text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 flex items-center">
      <i class="fas fa-plus mr-2"></i> Agregar Dirección
    </button>
  </div>
  <div id="direcciones-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</section>

<script>
(function(){
  let LS_KEY='direcciones';
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modal-title');
  const form = document.getElementById('modal-form');
  const formFields = document.getElementById('form-fields');
  const confirmModal = document.getElementById('confirm-modal');
  const confirmBtn = document.getElementById('confirm-delete-btn');
  let editingId = null;

  const seed = [
    { id:1, nombre:"Dirección de Salud", responsable:"Dra. Patricia Flores Vega", titulo:"Directora de Salud", descripcion:"Programas de salud pública y prevención", telefono:"(873) 742-0025", email:"salud@sabinashidalgo.gob.mx", icono:"fas fa-heartbeat" },
    { id:2, nombre:"Dirección de Obras Públicas", responsable:"Ing. Miguel Ángel Sánchez", titulo:"Director de Obras Públicas", descripcion:"Infraestructura y mantenimiento urbano", telefono:"(873) 742-0030", email:"obras@sabinashidalgo.gob.mx", icono:"fas fa-hard-hat" },
    { id:3, nombre:"Dirección de Educación y Cultura", responsable:"Profra. Ana Lucía Morales", titulo:"Directora de Educación", descripcion:"Programas educativos y actividades culturales", telefono:"(873) 742-0035", email:"educacion@sabinashidalgo.gob.mx", icono:"fas fa-graduation-cap" }
  ];

  function getAll(){
    const raw = localStorage.getItem(LS_KEY);
    if(!raw){ localStorage.setItem(LS_KEY, JSON.stringify(seed)); return seed.slice(); }
    try { return JSON.parse(raw); } catch { return seed.slice(); }
  }
  function saveAll(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

  function createCard(it){
    return `
      <div class="bg-white rounded-xl shadow-sm p-6 card-hover fade-in">
        <div class="flex items-start justify-between mb-4">
          <div class="flex items-center">
            <div class="bg-gov-blue bg-opacity-10 p-3 rounded-lg mr-3">
              <i class="${it.icono} text-gov-blue text-xl"></i>
            </div>
            <div>
              <h3 class="font-bold text-gray-800 text-lg">${it.nombre}</h3>
              <p class="text-gov-gray text-sm">${it.titulo}</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button data-id="${it.id}" class="dir-edit text-gov-blue hover:bg-blue-50 p-2 rounded-lg transition"><i class="fas fa-edit"></i></button>
            <button data-id="${it.id}" class="dir-del text-red-600 hover:bg-red-50 p-2 rounded-lg transition"><i class="fas fa-trash"></i></button>
          </div>
        </div>
        <div class="space-y-2 mb-4">
          <p class="text-sm text-gov-gray"><i class="fas fa-user mr-2"></i>${it.responsable}</p>
          <p class="text-sm text-gov-gray"><i class="fas fa-phone mr-2"></i>${it.telefono}</p>
          <p class="text-sm text-gov-gray"><i class="fas fa-envelope mr-2"></i>${it.email}</p>
        </div>
        <p class="text-gray-700 text-sm">${it.descripcion}</p>
      </div>`;
  }

  function render(){
    const grid = document.getElementById('direcciones-grid');
    const data = getAll();
    grid.innerHTML = data.map(createCard).join('');
    grid.querySelectorAll('.dir-edit').forEach(b=>b.onclick=()=>openModal(+b.dataset.id));
    grid.querySelectorAll('.dir-del').forEach(b=>b.onclick=()=>confirmDelete(+b.dataset.id));
  }

  function openModal(id=null){
    editingId = id;
    modalTitle.textContent = id ? 'Editar Dirección' : 'Agregar Dirección';
    formFields.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nombre *</label>
          <input type="text" id="form-nombre" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Responsable *</label>
          <input type="text" id="form-responsable" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Título/Cargo *</label>
        <input type="text" id="form-titulo" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Descripción *</label>
        <textarea id="form-descripcion" required rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent"></textarea>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono *</label>
          <input type="tel" id="form-telefono" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
          <input type="email" id="form-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Icono</label>
        <select id="form-icono" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gov-blue focus:border-transparent">
          <option value="fas fa-heartbeat">Salud</option>
          <option value="fas fa-hard-hat">Obras</option>
          <option value="fas fa-graduation-cap">Educación</option>
          <option value="fas fa-leaf">Ecología</option>
          <option value="fas fa-shield-alt">Seguridad</option>
        </select>
      </div>`;
    if(id){
      const it = getAll().find(x=>x.id===id);
      ['nombre','responsable','titulo','descripcion','telefono','email','icono'].forEach(k=>{
        const el = document.getElementById('form-'+k);
        if(el) el.value = it[k] || '';
      });
    }
    modal.classList.remove('hidden');
  }

  function confirmDelete(id){
    confirmModal.classList.remove('hidden');
    confirmBtn.onclick = ()=>{
      const arr = getAll().filter(x=>x.id!==id);
      saveAll(arr);
      confirmModal.classList.add('hidden');
      render();
    };
  }

  form.onsubmit = (e)=>{
    if(modal.classList.contains('hidden')) return;
    e.preventDefault();
    const data = {
      nombre: document.getElementById('form-nombre').value.trim(),
      responsable: document.getElementById('form-responsable').value.trim(),
      titulo: document.getElementById('form-titulo').value.trim(),
      descripcion: document.getElementById('form-descripcion').value.trim(),
      telefono: document.getElementById('form-telefono').value.trim(),
      email: document.getElementById('form-email').value.trim(),
      icono: document.getElementById('form-icono').value
    };
    const arr = getAll();
    if(editingId){
      const i = arr.findIndex(x=>x.id===editingId);
      arr[i] = { ...arr[i], ...data };
    }else{
      arr.push({ id: Date.now(), ...data });
    }
    saveAll(arr);
    modal.classList.add('hidden');
    editingId = null;
    render();
  };

  document.getElementById('dir-add').onclick = ()=> openModal();
  render();
})();
</script>
