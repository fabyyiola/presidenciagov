<!-- ServiciosPublicos.html (Public module) -->
<section id="ServiciosPublicos" class="bg-gray-50 font-sans">
  <!-- Header / Hero Section -->
  <header class="institutional-gradient hero-pattern text-white">
    <div class="container mx-auto px-6 py-16 text-center max-w-4xl">
      <i class="fas fa-hands-helping text-6xl mb-4 opacity-90"></i>
      <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
        Servicios Municipales y<br>
        <span class="text-green-200">Apoyo Comunitario</span>
      </h1>
      <p class="text-xl md:text-2xl mb-8 text-blue-100 leading-relaxed">
        Programas y Beneficios para la Comunidad
      </p>
      <p class="text-lg mb-10 text-blue-50 max-w-2xl mx-auto">
        Descubre los programas sociales disponibles para ti y tu familia. Estamos aquí para apoyarte en cada etapa de tu vida.
      </p>
      <button onclick="scrollToForm()" class="bg-white text-blue-700 px-8 py-4 rounded-xl font-bold text-lg hover:bg-blue-50 transition-all duration-300 shadow-lg hover:shadow-xl">
        <i class="fas fa-edit mr-3"></i> Solicitar Apoyo Ahora
      </button>
    </div>
  </header>

  <!-- Programs Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-6">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Programas Disponibles</h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Conoce todos los programas sociales que tenemos para ti</p>
      </div>
      <div id="programs-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
    </div>
  </section>

  <!-- Application Form Section -->
  <section id="application-form" class="py-16 form-section">
    <div class="container mx-auto px-6 max-w-4xl">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Solicitud de Apoyo</h2>
        <p class="text-xl text-gray-600">Completa el formulario para solicitar el programa que necesitas</p>
      </div>
      <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12">
        <form id="support-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="fullName" class="block text-sm font-semibold text-gray-700 mb-2">Nombre Completo *</label>
              <input id="fullName" name="fullName" required class="w-full px-4 py-3 border rounded-lg" />
            </div>
            <div>
              <label for="curp" class="block text-sm font-semibold text-gray-700 mb-2">CURP *</label>
              <input id="curp" name="curp" required maxlength="18" class="w-full px-4 py-3 border rounded-lg uppercase" />
            </div>
            <div>
              <label for="age" class="block text-sm font-semibold text-gray-700 mb-2">Edad *</label>
              <input id="age" name="age" type="number" min="1" max="120" required class="w-full px-4 py-3 border rounded-lg" />
            </div>
            <div>
              <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">Teléfono *</label>
              <input id="phone" name="phone" required class="w-full px-4 py-3 border rounded-lg" />
            </div>
          </div>
          <div>
            <label for="address" class="block text-sm font-semibold text-gray-700 mb-2">Dirección *</label>
            <textarea id="address" name="address" rows="3" required class="w-full px-4 py-3 border rounded-lg"></textarea>
          </div>
          <div>
            <label for="program" class="block text-sm font-semibold text-gray-700 mb-2">Programa Solicitado *</label>
            <select id="program" name="program" required class="w-full px-4 py-3 border rounded-lg"></select>
          </div>
          <div>
            <label for="reason" class="block text-sm font-semibold text-gray-700 mb-2">Motivo *</label>
            <textarea id="reason" name="reason" rows="4" required class="w-full px-4 py-3 border rounded-lg"></textarea>
          </div>
          <label class="flex items-start bg-blue-50 border rounded-lg p-4">
            <input type="checkbox" id="privacy" required class="mt-1" />
            <span class="ml-3 text-sm text-gray-700">Acepto la política de privacidad y autorizo el tratamiento de mis datos.</span>
          </label>
          <div class="text-center pt-6">
            <button type="submit" class="bg-gradient-to-r from-blue-600 to-green-600 text-white px-12 py-4 rounded-xl font-bold">Enviar Solicitud</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl max-w-md w-full p-8 text-center">
      <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-check text-green-600 text-2xl"></i>
      </div>
      <h3 class="text-2xl font-bold text-gray-800 mb-4">¡Solicitud Enviada!</h3>
      <p class="text-gray-600 mb-6">Tu solicitud ha sido recibida correctamente. Te contactaremos pronto.</p>
      <p class="text-sm text-gray-500 mb-6">ID de solicitud: <span id="request-id" class="font-mono font-bold"></span></p>
      <button onclick="closeSuccessModal()" class="bg-green-600 text-white px-6 py-3 rounded-lg">Entendido</button>
    </div>
  </div>
</section>

<script>
(() => {
  const STORAGE_KEY = 'municipio.solicitudes.v1';
  const programs = [
    { id:'desayunos-escolares', name:'Desayunos Escolares' },
    { id:'apoyo-economico', name:'Apoyo Económico Familiar' },
    { id:'limpieza-fachadas', name:'Limpieza de Fachadas' },
    { id:'campanas-salud', name:'Campañas de Salud' },
    { id:'becas-educativas', name:'Becas Educativas' },
    { id:'adultos-mayores', name:'Programa Adultos Mayores' },
    { id:'emprendimiento', name:'Apoyo al Emprendimiento' },
    { id:'deporte-cultura', name:'Deporte y Cultura' }
  ];

  let requests = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(requests)); }
  function generateId() {
    const year = new Date().getFullYear();
    return `REQ-${year}-${(requests.length+1).toString().padStart(3,'0')}`;
  }

  function renderPrograms() {
    document.getElementById('programs-grid').innerHTML = programs.map(p => `
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-2"><i class="fas fa-check-circle text-blue-600 mr-2"></i>${p.name}</h3>
        <button onclick="selectProgram('${p.id}')" class="text-blue-600 font-semibold">Solicitar</button>
      </div>`).join('');
    document.getElementById('program').innerHTML = '<option value="">Selecciona un programa</option>' + programs.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
  }

  document.getElementById('support-form').addEventListener('submit', e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    const request = { id: generateId(), ...data, status:'pending', submissionDate: new Date().toISOString().split('T')[0] };
    requests.unshift(request);
    save();
    document.getElementById('request-id').textContent = request.id;
    document.getElementById('success-modal').classList.remove('hidden');
    e.target.reset();
  });

  window.scrollToForm = () => document.getElementById('application-form').scrollIntoView({behavior:'smooth'});
  window.selectProgram = pid => { const p=programs.find(x=>x.id===pid); if(p){document.getElementById('program').value=p.name; scrollToForm();}};
  window.closeSuccessModal = () => document.getElementById('success-modal').classList.add('hidden');

  // Public getter for admin page
  window.Servicios = { getSolicitudes: () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') };

  renderPrograms();
})();
</script>
