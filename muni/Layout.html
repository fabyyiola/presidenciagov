
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administración Municipal - SPA</title>

  <!-- Tailwind + FontAwesome (match admin.html) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'gov-blue': '#1e40af',
            'gov-green': '#059669',
            'gov-gray': '#6b7280',
            'gov-light': '#f8fafc'
          }
        }
      }
    }
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    .sidebar-transition { transition: all 0.3s ease; }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
    .modal-backdrop { backdrop-filter: blur(4px); }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }

    /* Simple page loader */
    #page-loader { display:none; }
    #page-loader.active { display:flex; }
  </style>
</head>
<body class="bg-gov-light font-sans">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200 fixed w-full top-0 z-40">
    <div class="flex items-center justify-between px-6 py-4">
      <div class="flex items-center">
        <button id="sidebarToggle" class="lg:hidden mr-4 text-gov-gray hover:text-gov-blue transition duration-200">
          <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center">
          <div class="bg-gradient-to-r from-gov-blue to-gov-green text-white p-2 rounded-lg mr-3">
            <i class="fas fa-city text-xl"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-800">Administración Municipal</h1>
            <p class="text-sm text-gov-gray">Sabinas Hidalgo, Nuevo León</p>
          </div>
        </div>
      </div>

      <div class="flex items-center space-x-4">
        <button class="text-gov-gray hover:text-gov-blue transition duration-200">
          <i class="fas fa-bell text-lg"></i>
        </button>
        <div class="flex items-center space-x-2">
          <div class="text-right">
            <p class="text-sm font-medium text-gray-800">Admin Usuario</p>
            <p class="text-xs text-gov-gray">Administrador</p>
          </div>
          <div class="w-8 h-8 bg-gov-blue rounded-full flex items-center justify-center">
            <i class="fas fa-user text-white text-sm"></i>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed left-0 top-16 h-full w-64 bg-white shadow-lg transform -translate-x-full lg:translate-x-0 sidebar-transition z-30">
    <nav class="p-6">
      <ul class="space-y-2">
        <!-- CORE MENU ITEMS -->
        <li>
          <a href="#" data-route="dashboard" class="nav-link flex items-center p-3 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200">
            <i class="fas fa-tachometer-alt mr-3"></i>
            Dashboard
          </a>
        </li>

        <!-- EQUIPO PARENT MENU -->
        <li>
          <div class="menu-parent">
            <button data-submenu="equipo" class="nav-parent flex items-center justify-between w-full p-3 rounded-lg text-gov-gray hover:bg-gray-100 transition duration-200">
              <div class="flex items-center">
                <i class="fas fa-users-cog mr-3"></i>
                Equipo
              </div>
              <i class="fas fa-chevron-right transition-transform duration-200 submenu-arrow"></i>
            </button>
            <ul id="equipo-submenu" class="ml-6 mt-2 space-y-1 hidden">
              <li>
                <a href="#" data-route="secretarias" class="nav-link flex items-center p-2 pl-4 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200 text-sm">
                  <i class="fas fa-building mr-3 text-xs"></i>
                  Secretarías
                </a>
              </li>
              <li>
                <a href="#" data-route="direcciones" class="nav-link flex items-center p-2 pl-4 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200 text-sm">
                  <i class="fas fa-sitemap mr-3 text-xs"></i>
                  Direcciones
                </a>
              </li>
              <li>
                <a href="#" data-route="cabildo" class="nav-link flex items-center p-2 pl-4 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200 text-sm">
                  <i class="fas fa-users mr-3 text-xs"></i>
                  Cabildo Municipal
                </a>
              </li>
            </ul>
          </div>
        </li>

        <li>
          <a href="#" data-route="negocios" class="nav-link flex items-center p-3 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200">
            <i class="fas fa-store mr-3"></i>
            Negocios Registrados
          </a>
        </li>

        <li>
          <a href="#" data-route="lugares" class="nav-link flex items-center p-3 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200">
            <i class="fas fa-map-marked-alt mr-3"></i>
            Lugares Turísticos
          </a>
        </li>

        <li>
          <a href="#" data-route="eventos" class="nav-link flex items-center p-3 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200">
            <i class="fas fa-calendar-alt mr-3"></i>
            Eventos
          </a>
        </li>

        <li>
          <a href="#" data-route="tramites" class="nav-link flex items-center p-3 rounded-lg text-gov-gray hover:bg-gov-blue hover:text-white transition duration-200">
            <i class="fas fa-file-alt mr-3"></i>
            Trámites
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Dynamic area -->
  <main class="lg:ml-64 pt-16 min-h-screen">
    <section id="app" class="p-6"></section>
  </main>

  <!-- Page loader -->
  <div id="page-loader" class="fixed inset-0 bg-black bg-opacity-25 z-50 items-center justify-center">
    <div class="animate-spin rounded-full h-14 w-14 border-b-2 border-white"></div>
  </div>

  <script>
    // --------------------------------------------------
    // Global localStorage helpers (shared across pages)
    // --------------------------------------------------
    const LS = {
      get(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return fallback;
          return JSON.parse(raw);
        } catch (e) { return fallback; }
      },
      set(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      },
      ensureDefaults() {
        // Seed only if missing; sample data mirrors admin.html
        if (!localStorage.getItem('secretarias')) {
          LS.set('secretarias', [
            { id:1, nombre:"Secretaría del Ayuntamiento", responsable:"Lic. Carlos Mendoza Ruiz", titulo:"Secretario del Ayuntamiento", descripcion:"Encargada de la administración general y actas de cabildo", telefono:"(873) 742-0001", email:"secretaria@sabinashidalgo.gob.mx", icono:"fas fa-gavel" },
            { id:2, nombre:"Secretaría de Finanzas", responsable:"C.P. María Elena Torres", titulo:"Secretaria de Finanzas", descripcion:"Administración de recursos financieros municipales", telefono:"(873) 742-0015", email:"finanzas@sabinashidalgo.gob.mx", icono:"fas fa-coins" },
            { id:3, nombre:"Secretaría de Desarrollo Social", responsable:"Lic. Roberto Hernández", titulo:"Secretario de Desarrollo Social", descripcion:"Programas sociales y desarrollo comunitario", telefono:"(873) 742-0020", email:"desarrollo@sabinashidalgo.gob.mx", icono:"fas fa-heart" }
          ]);
        }
        if (!localStorage.getItem('direcciones')) {
          LS.set('direcciones', [
            { id:1, nombre:"Dirección de Salud", responsable:"Dra. Patricia Flores Vega", titulo:"Directora de Salud", descripcion:"Programas de salud pública y prevención", telefono:"(873) 742-0025", email:"salud@sabinashildo.gob.mx", icono:"fas fa-heartbeat" },
            { id:2, nombre:"Dirección de Obras Públicas", responsable:"Ing. Miguel Ángel Sánchez", titulo:"Director de Obras Públicas", descripcion:"Infraestructura y mantenimiento urbano", telefono:"(873) 742-0030", email:"obras@sabinashidalgo.gob.mx", icono:"fas fa-hard-hat" },
            { id:3, nombre:"Dirección de Educación y Cultura", responsable:"Profra. Ana Lucía Morales", titulo:"Directora de Educación", descripcion:"Programas educativos y actividades culturales", telefono:"(873) 742-0035", email:"educacion@sabinashidalgo.gob.mx", icono:"fas fa-graduation-cap" }
          ]);
        }
        if (!localStorage.getItem('cabildo')) {
          LS.set('cabildo', [
            { id:1, nombre:"Lic. José Manuel Rodríguez", titulo:"Primer Regidor", descripcion:"Comisión de Hacienda y Patrimonio", telefono:"(873) 742-0040", email:"regidor1@sabinashidalgo.gob.mx", partido:"Partido Acción Nacional", icono:"fas fa-user-tie" },
            { id:2, nombre:"Lic. Carmen Beatriz López", titulo:"Segunda Regidora", descripcion:"Comisión de Desarrollo Social", telefono:"(873) 742-0041", email:"regidor2@sabinashidalgo.gob.mx", partido:"Movimiento Ciudadano", icono:"fas fa-female" },
            { id:3, nombre:"Ing. Fernando Castillo Vega", titulo:"Tercer Regidor", descripcion:"Comisión de Obras Públicas", telefono:"(873) 742-0042", email:"regidor3@sabinashidalgo.gob.mx", partido:"PRI", icono:"fas fa-user-tie" }
          ]);
        }
        if (!localStorage.getItem('eventos')) {
          LS.set('eventos', []); // Pages seed detailed examples if empty
        }
        if (!localStorage.getItem('tramites')) {
          LS.set('tramites', []);
        }
        if (!localStorage.getItem('negocios')) {
          LS.set('negocios', []);
        }
        if (!localStorage.getItem('lugaresTuristicos')) {
          LS.set('lugaresTuristicos', []);
        }
      }
    };

    // --------------------------------------------------
    // Simple router
    // --------------------------------------------------
    const ROUTES = {
      'dashboard': 'Dashboard.html',
      'secretarias': 'Secretarias.html',
      'direcciones': 'Direcciones.html',
      'cabildo': 'Cabildo Municipal.html',
      'negocios': 'Negocios.html',
      'lugares': 'Turismo.html',
      'eventos': 'Eventos.html',
      'tramites': 'Tramites.html'
    };

    const appEl = document.getElementById('app');
    const pageLoader = document.getElementById('page-loader');

    function setActiveLink(route){
      document.querySelectorAll('.nav-link').forEach(a=>{
        a.classList.remove('bg-gov-blue','text-white');
        a.classList.add('text-gov-gray');
        if (a.dataset.route === route) {
          a.classList.add('bg-gov-blue','text-white');
          a.classList.remove('text-gov-gray');
        }
      });
    }

    async function loadRoute(route){
      const file = ROUTES[route];
      if(!file) return;
      try {
        pageLoader.classList.add('active');
        const res = await fetch(file, { cache: 'no-cache' });
        const html = await res.text();
        appEl.innerHTML = html;
        setActiveLink(route);
        // Run any inline <script> tags in the injected HTML
        appEl.querySelectorAll('script').forEach(s => {
          const n = document.createElement('script');
          if (s.src) { n.src = s.src; } else { n.textContent = s.textContent; }
          document.body.appendChild(n);
          n.remove();
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } finally {
        pageLoader.classList.remove('active');
      }
    }

    // Submenu toggling
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-submenu]');
      if(btn){
        const id = btn.getAttribute('data-submenu');
        const list = document.getElementById(id + '-submenu');
        const arrow = btn.querySelector('.submenu-arrow');
        const hidden = list.classList.contains('hidden');
        list.classList.toggle('hidden', !hidden ? true : false); // toggle
        if (hidden) { list.classList.remove('hidden'); arrow.classList.add('rotate-90'); }
        else { list.classList.add('hidden'); arrow.classList.remove('rotate-90'); }
      }
    });

    // Route clicks
    document.addEventListener('click', (e)=>{
      const link = e.target.closest('a.nav-link[data-route]');
      if(link){
        e.preventDefault();
        const route = link.getAttribute('data-route');
        history.pushState({route}, '', '#' + route);
        loadRoute(route);
      }
    });

    // Sidebar toggle
    document.getElementById('sidebarToggle').addEventListener('click', function() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('-translate-x-full');
    });

    // On load: seed defaults, and open Secretarías by default per spec
    LS.ensureDefaults();
    const initialRoute = (location.hash && location.hash.slice(1)) || 'secretarias';
    loadRoute(initialRoute);

    // Handle back/forward
    window.addEventListener('popstate', (e)=>{
      const route = (location.hash && location.hash.slice(1)) || 'secretarias';
      loadRoute(route);
    });
  </script>
</body>
</html>
