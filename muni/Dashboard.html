
<div class="mb-8">
  <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard Económico Municipal</h2>
  <p class="text-gov-gray">Monitoreo del crecimiento y impacto de negocios locales</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-2xl font-bold text-gray-800" id="total-businesses-count">0</p>
        <p class="text-gov-gray">Negocios Registrados</p>
        <p class="text-xs text-green-600 mt-1" id="business-growth">+0% este mes</p>
      </div>
      <div class="bg-gov-blue bg-opacity-10 p-3 rounded-lg">
        <i class="fas fa-store text-gov-blue text-xl"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-2xl font-bold text-gray-800" id="new-businesses-month">0</p>
        <p class="text-gov-gray">Nuevos este Mes</p>
        <p class="text-xs text-blue-600 mt-1" id="monthly-trend">Últimos 30 días</p>
      </div>
      <div class="bg-gov-green bg-opacity-10 p-3 rounded-lg">
        <i class="fas fa-plus-circle text-gov-green text-xl"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-2xl font-bold text-gray-800" id="weekend-businesses">0</p>
        <p class="text-gov-gray">Abiertos Fin de Semana</p>
        <p class="text-xs text-purple-600 mt-1" id="weekend-percentage">0% del total</p>
      </div>
      <div class="bg-purple-600 bg-opacity-10 p-3 rounded-lg">
        <i class="fas fa-calendar-weekend text-purple-600 text-xl"></i>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-2xl font-bold text-gray-800" id="digital-businesses">0</p>
        <p class="text-gov-gray">Con Servicios Digitales</p>
        <p class="text-xs text-orange-600 mt-1" id="digital-percentage">0% del total</p>
      </div>
      <div class="bg-orange-500 bg-opacity-10 p-3 rounded-lg">
        <i class="fas fa-wifi text-orange-500 text-xl"></i>
      </div>
    </div>
  </div>
</div>

<div class="bg-white rounded-xl shadow-sm p-6">
  <h3 class="text-lg font-bold text-gray-800 mb-2">Actividad Reciente</h3>
  <div id="recent-businesses" class="space-y-3"></div>
</div>

<script>
  (function(){
    const negocios = JSON.parse(localStorage.getItem('negocios') || '[]');

    // KPIs
    const total = negocios.length;
    document.getElementById('total-businesses-count').textContent = total;

    // Fake simple monthly/new calc (last 30d if has createdAt)
    const now = Date.now();
    const THIRTY = 1000 * 60 * 60 * 24 * 30;
    const recent = negocios.filter(n => n.createdAt && (now - new Date(n.createdAt).getTime()) < THIRTY);
    document.getElementById('new-businesses-month').textContent = recent.length;
    document.getElementById('monthly-trend').textContent = "Últimos 30 días";

    // Weekend / Digital heuristics
    const weekend = negocios.filter(n => n.finDeSemana === true).length;
    const weekendPct = total ? Math.round(weekend * 100 / total) : 0;
    document.getElementById('weekend-businesses').textContent = weekend;
    document.getElementById('weekend-percentage').textContent = weekendPct + "% del total";

    const digital = negocios.filter(n => n.serviciosDigitales === true).length;
    const digitalPct = total ? Math.round(digital * 100 / total) : 0;
    document.getElementById('digital-businesses').textContent = digital;
    document.getElementById('digital-percentage').textContent = digitalPct + "% del total";

    // Recent list
    const listEl = document.getElementById('recent-businesses');
    if (recent.length === 0) {
      listEl.innerHTML = '<p class="text-gov-gray">Aún no hay registros recientes.</p>';
    } else {
      listEl.innerHTML = recent
        .sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt))
        .slice(0,8)
        .map(n => \`
          <div class="flex items-center justify-between border rounded-lg p-3">
            <div>
              <p class="font-semibold text-gray-800">\${n.nombre || 'Negocio'}</p>
              <p class="text-sm text-gov-gray">\${n.categoria || 'Sin categoría'} — \${n.propietario || ''}</p>
            </div>
            <span class="text-xs text-gov-gray">\${new Date(n.createdAt).toLocaleDateString()}</span>
          </div>
        \`).join('');
    }
  })();
</script>
