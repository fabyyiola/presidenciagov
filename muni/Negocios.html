
<div class="flex justify-between items-center mb-8">
  <div>
    <h2 class="text-3xl font-bold text-gray-800 mb-2">Negocios Registrados</h2>
    <p class="text-gov-gray">Administración y seguimiento de negocios locales</p>
  </div>
  <div class="flex items-center space-x-4">
    <div class="bg-white rounded-lg px-4 py-2 shadow-sm border">
      <span class="text-sm text-gov-gray">Total de negocios:</span>
      <span class="font-bold text-gov-blue ml-2" id="total-businesses">0</span>
    </div>
    <button id="export-btn" class="bg-gov-green text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 flex items-center">
      <i class="fas fa-download mr-2"></i>
      Exportar
    </button>
  </div>
</div>

<div class="bg-white rounded-xl shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Negocio</th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Propietario</th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contacto</th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
        </tr>
      </thead>
      <tbody id="business-table-body" class="bg-white divide-y divide-gray-200"></tbody>
    </table>
  </div>
  <div id="empty-business-state" class="text-center py-12 hidden">
    <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
      <i class="fas fa-store text-gray-400 text-2xl"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-800 mb-2">No hay negocios registrados</h3>
    <p class="text-gov-gray">Los negocios aparecerán aquí cuando se registren desde el portal público.</p>
  </div>
</div>

<script>
(function(){
  const tbody = document.getElementById('business-table-body');
  const empty = document.getElementById('empty-business-state');
  const totalEl = document.getElementById('total-businesses');
  let data = JSON.parse(localStorage.getItem('negocios')||'[]');

  // demo seed if empty
  if (!data.length) {
    data = [
      { id: 1, nombre: "Panadería La Tradición", propietario:"María Pérez", categoria:"Alimentos y Bebidas", telefono:"(873) 111-2222", email:"panaderia@example.com", createdAt: new Date().toISOString(), serviciosDigitales:true, finDeSemana:true },
      { id: 2, nombre: "Taller Mecánico El Turbo", propietario:"Juan López", categoria:"Servicios", telefono:"(873) 333-4444", email:"taller@example.com", createdAt: new Date(Date.now()-86400000*40).toISOString() }
    ];
    localStorage.setItem('negocios', JSON.stringify(data));
  }

  function render(){
    totalEl.textContent = data.length;
    if (!data.length){ empty.classList.remove('hidden'); tbody.innerHTML = ''; return; }
    empty.classList.add('hidden');
    tbody.innerHTML = data.map(n => \`
      <tr>
        <td class="px-6 py-4 whitespace-nowrap">\${n.nombre}</td>
        <td class="px-6 py-4 whitespace-nowrap">\${n.propietario || ''}</td>
        <td class="px-6 py-4 whitespace-nowrap">\${n.categoria || ''}</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gov-gray">\${n.telefono || ''} \${n.email ? ' • '+n.email : ''}</td>
        <td class="px-6 py-4 whitespace-nowrap space-x-2">
          <button data-id="\${n.id}" class="edit px-3 py-1 text-sm border rounded-lg">Editar</button>
          <button data-id="\${n.id}" class="del px-3 py-1 text-sm bg-red-600 text-white rounded-lg">Eliminar</button>
        </td>
      </tr>
    \`).join('');
  }

  function save(){ localStorage.setItem('negocios', JSON.stringify(data)); }
  function del(id){ data = data.filter(x=>x.id!==id); save(); render(); }

  tbody.addEventListener('click', (e)=>{
    const delBtn = e.target.closest('button.del');
    if(delBtn){ del(Number(delBtn.dataset.id)); return; }
    const editBtn = e.target.closest('button.edit');
    if(editBtn){
      const item = data.find(x=>x.id===Number(editBtn.dataset.id));
      const nombre = prompt('Nombre', item.nombre) || item.nombre;
      const propietario = prompt('Propietario', item.propietario || '') || item.propietario;
      Object.assign(item, {nombre, propietario});
      save(); render();
    }
  });

  document.getElementById('export-btn').addEventListener('click', ()=>{
    const url = URL.createObjectURL(new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}));
    const a = document.createElement('a');
    a.href = url; a.download = 'negocios.json'; a.click();
    URL.revokeObjectURL(url);
  });

  render();
})();
</script>
